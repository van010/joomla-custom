jQuery(document).ready(function(t){let a=!0,e=!0;const _={};function i(a){if(!e)return;let _=a.attr("data-filter-number"),i=a.find(".acym__automation__or__total__result"),o=ACYM_AJAX_URL+"&page=acymailing_automation&ctrl=automation&task=countResultsOrTotal&or="+_;i.html('<i class="acymicon-circle-o-notch acymicon-spin"></i>'),t.get(o,a.closest("#acym_form").serialize()+"&page=acymailing_automation&ctrl=automation&task=countResultsOrTotal&or="+_).done(function(t){i.html(t)}).fail(function(){i.html(ACYM_JS_TXT.ACYM_ERROR)})}function o(){n("classic"),n("user"),t(".acym__automation__add-filter").off("click").on("click",function(){let a=t(this).closest(".acym__automation__group__filter").find(".acym__automation__one__filter").length;if(0===a){let a=t("#acym__automation__and__example").clone().removeAttr("id");a.find(".acym__automation__and").remove(),t(this).parent().before(a.show())}else t(this).parent().before(t("#acym__automation__and__example").clone().removeAttr("id").show());let e=t(this).parent().prev();e.addClass("acym__automation__one__filter__"+t(this).attr("data-filter-type")),e.find(".acym__automation__and__example__"+t(this).attr("data-filter-type")+"__select").show().find("select").addClass("acym__select").select2({theme:"foundation",width:"100%"}),o()}),t(".acym__automation__choose__filter").off("click").on("click",function(){t("#acym__automation__type-filter__input").val(t(this).attr("data-filter")),t(".selected-filter").removeClass("selected-filter"),t(this).addClass("selected-filter");let a=t(".acym__automation__filter__container");a.hide(),a.find('[name^="acym_action"]').each(function(a){t(this).attr("name",t(this).attr("name").replace("acym_action",""))});let e=t("#acym__automation__filters__type__"+t(this).attr("data-filter"));e.show(),e.find('[name^="[filters]"]').each(function(a){t(this).attr("name","acym_action"+t(this).attr("name"))})}),t(".acym__automation__filters__or").off("click").on("click",function(){let a=t("#acym__automation__filters__count__or");a.val(parseInt(a.val())+1),t(this).before(t("#acym__automation__or__example").html());let e=t(this).prev();e.attr("data-filter-number",a.val()),o(),e.find("button[data-filter-type]").attr("data-filter-type",t(this).attr("data-filter-type")).click(),"classic"===t(this).attr("data-filter-type")&&i(e)}),t(".acym__automation__delete__one__filter").off("click").on("click",function(){let a=t(this).closest(".acym__automation__group__filter");t(this).parent().parent().remove(),i(a)}),t(".acym__automation__delete__group__filter").off("click").on("click",function(){t(this).parent().parent().prev().remove(),t(this).parent().parent().remove()}),acym_helperDatePicker.setDatePickerGlobal(),acym_helperDatePicker.setRSDateChoice(),acym_helperSelect2.setAjaxSelect2(),acym_helperFilter.setAutomationReload()}function n(a){let e=t("#acym__automation__filter__"+a+"__options");if(!e.length)return;let _=JSON.parse(e.val());t(".acym__automation__select__"+a+"__filter").off("change").on("change",function(){let e=t("#acym__automation__filters__count__and");e.val(parseInt(e.val())+1);let n=acym_helperSegment.getSeeUserModalButton(t(this),e.val());t(this).parent().parent().find(".acym__automation__inserted__filter").remove();let l=_[t(this).val()].replace(/__numor__/g,t(this).closest(".acym__automation__group__filter").attr("data-filter-number"));l=l.replace(/__numand__/g,e.val()),t(this).parent().after('<div data-and="'+e.val()+'" class="cell grid-x grid-margin-x margin-y acym__automation__inserted__filter margin-top-1 margin-left-2 padding-right-2"><div class="cell grid-x"><span class="cell shrink margin-right-1 countresults margin-bottom-1" id="results_'+e.val()+'"></span>'+n+"</div>"+l+"</div>"),acym_helperSelect2.setSelect2(),acym_helperDatePicker.setDatePickerGlobal(),acym_helperTooltip.setTooltip(),jQuery(document).foundation(),jQuery(document).trigger("acym__modal__users__summary__ready"),t(".switch-label").off("click").on("click",function(){let a=t('input[data-switch="'+t(this).attr("for")+'"]');a.attr("value",1-a.attr("value"))});let c=t(this).closest(".acym__automation__one__filter").find(".acym__automation__filters__operator__dropdown"),r=t(this).closest(".acym__automation__one__filter").find(".acym__automation__filters__fields__dropdown");c.on("change",function(){r.trigger("change")}),r.on("change",function(){let a=t(this).closest(".acym__automation__inserted__filter"),e=a.find('[data-filter-field="'+t(this).val()+'"]'),_=a.find(".acym__automation__filters__fields__select"),i=a.find(".acym__automation__filter__regular-field");e.length>0&&("="===c.val()||"!="===c.val())?(i.attr("name",i.attr("name").replace("acym_action","")).hide(),_.each(function(a){t(this).attr("name",t(this).attr("name").replace("acym_action","")),t(this).closest(".acym__automation__one-field").hide()}),-1===e.attr("name").indexOf("acym_action")&&e.attr("name","acym_action"+e.attr("name")),e.closest(".acym__automation__one-field").show()):(-1===i.attr("name").indexOf("acym_action")&&i.attr("name","acym_action"+i.attr("name")),_.length>0&&_.each(function(){t(this).attr("name",t(this).attr("name").replace("acym_action","")),t(this).closest(".acym__automation__one-field").hide()}),i.show())}).trigger("change"),"classic"===a&&(t(this).closest(".acym__automation__one__filter.acym__automation__one__filter__classic").find(".acym__automation__inserted__filter input, .acym__automation__inserted__filter textarea, .acym__automation__inserted__filter select").on("change",function(){t.reloadCounters(this)}),0==t(this).val()?i(t(this).closest(".acym__automation__group__filter")):t.reloadCounters(t(this).closest(".acym__automation__one__filter.acym__automation__one__filter__classic").find(".acym__automation__inserted__filter input, .acym__automation__inserted__filter textarea, .acym__automation__inserted__filter select")));let m=t(this).closest(".acym__automation__one__filter").find("[data-acym-toggle-filter]");acym_helperFilter.setToggle(m),t(document).foundation(),t(".reveal-overlay").appendTo("#acym_form"),o()})}t.reloadCounters=function(e){if(!a)return;let o=t(e).closest(".acym__automation__group__filter").attr("data-filter-number"),n=t(e).closest(".acym__automation__group__filter"),l=t(e).closest(".acym__automation__inserted__filter").attr("data-and"),c=ACYM_AJAX_URL+"&page=acymailing_automation&ctrl=automation&task=countresults&or="+o+"&and="+l;void 0!==_[l]&&_[l].abort(),t("#results_"+l).css("maxHeight","18px").html('<i class="acymicon-circle-o-notch acymicon-spin"></i>');let r=t(e).closest("#acym_form").serialize()+"&page=acymailing_automation&ctrl=automation&task=countresults&or="+o+"&and="+l;_[l]=t.get(c,r).done(function(a){t("#results_"+l).css("maxHeight","").html(a)}).fail(function(){t("#results_"+l).css("maxHeight","").html(ACYM_JS_TXT.ACYM_ERROR)}),i(n)},i(t(".acym__automation__select__classic__filter").closest(".acym__automation__group__filter")),o(),function(){let _=t("#filters");if(!_.length)return;let i=JSON.parse(_.val()),n=i.type_filter,l=0;t.each(i,function(_,i){let o=0;if("type_filter"===_)return!0;0!==l&&t('.acym__automation__filters__or[data-filter-type="'+n+'"]').click(),e=!1;let c=Object.keys(i).slice(-1)[0];t.each(i,function(_,i){0!==o&&t('.acym__automation__group__filter[data-filter-number="'+l+'"]').find('.acym__automation__add-filter[data-filter-type="'+n+'"]').click(),a=!1,t.each(i,function(i,o){let r=t('.acym__automation__group__filter[data-filter-number="'+l+'"]').find(".acym__automation__select__"+n+"__filter").last();r.val(i),r.trigger("change");let m=Object.keys(o);t.each(m,function(n){let r=m[n],s=o[m[n]],f=t('[name="acym_action[filters]['+l+"]["+t("#acym__automation__filters__count__and").val()+"]["+i+"]["+r+']"]');acym_helperFilter.setFieldValue(f,s),n===m.length-1&&(a=!0,c===_&&(e=!0)),f.trigger("change")})}),o++}),l++}),o()}()});