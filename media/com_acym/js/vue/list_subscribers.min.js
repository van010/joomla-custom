jQuery(document).ready(function(e){if(e("#requireConfirmation").length>0){let s=20,r=s,i=500;const t=["email","name"],c=(e,s,r)=>e.filter(e=>-1!==r.map(r=>-1!==e[r].toLowerCase().indexOf(s.toLowerCase())).indexOf(!0));new Vue({directives:{infiniteScroll:infiniteScroll},el:"#acym__list__settings__subscribers",data:{subscribed:[],displayedSubscribers:[],busy:!1,listid:0,total:0,loading:!0,searchSubscribers:"",requireConfirmation:0,users_ordering:"id",users_ordering_sort_order:"desc"},mounted:function(){document.querySelector('.acym__list__settings__subscribers__search input[type="text"]').addEventListener("keydown",function(e){if(13==e.keyCode)return e.preventDefault(),!1}),this.requireConfirmation=document.getElementById("requireConfirmation").value;let e=document.getElementById("acym__list__settings__subscribers__listing");null!==e&&(e.style.display="flex"),this.subscribed=JSON.parse(document.getElementById("subscribers_subscribed").value),this.listid=document.querySelector('[name="id"]').value,this.total=this.subscribed.length,this.displayedSubscribers=this.subscribed.slice(0,r),this.total<i?this.loading=!1:this.getAllSubscribers()},methods:{loadMoreSubscriber(){r+=s,this.displayedSubscribers=""===this.searchSubscribers?this.subscribed.slice(0,r):c(this.subscribed,this.searchSubscribers,t)},getAllSubscribers(){let r=document.querySelector('[name="ctrl"]').value;e.get(ACYM_AJAX_URL+"&ctrl="+r+"&task=loadMoreSubscribers&offset="+this.total+"&perCalls="+i+"&listid="+this.listid+"&orderBy="+this.users_ordering+"&orderByOrdering="+this.users_ordering_sort_order,e=>{if(void 0!==(e=JSON.parse(e)).error)return console.log(e.error),!1;if(0===e.data.length)return this.loading=!1,!0;let r=e.data.length;return this.subscribed=this.subscribed.concat(e.data),this.total+=r,this.displayedSubscribers=this.subscribed.slice(0,s),r<i?(this.loading=!1,!0):(this.getAllSubscribers(),!0)})},doSearch(){""===this.searchSubscribers?(r=s,this.displayedSubscribers=this.subscribed.slice(0,r)):this.displayedSubscribers=c(this.subscribed,this.searchSubscribers,t)},unsubscribeUser(s){let r=e("#acym_form");e('[name="acym__entity_select__selected"]').val(""),e('[name="acym__entity_select__unselected"]').val("["+s+"]"),r.find('[name="task"]').attr("value","saveSubscribers"),r.submit()},sortOrdering(s){let r=e('[name="users_ordering_sort_order"]');r.val("asc"==r.val()?"desc":"asc"),e(s.target).toggleClass("acymicon-sort-amount-desc acymicon-sort-amount-asc"),this.users_ordering_sort_order=r.val(),this.getAgainSubscribers()},getAgainSubscribers(){this.subscribed=[],this.displayedSubscribers=[],this.total=0,this.loading=!0,this.getAllSubscribers()}},watch:{searchSubscribers(){this.doSearch()},users_ordering(){this.getAgainSubscribers()}}})}});